<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <title>Minichua: Miniature Model Finder</title>
</head>
<body>
    <div id="app">
        <h1>Mini Finder</h1> 
        <label for='tag'>Filter by tag:</label>
        <select @change='tagSelect($event)' name='tag' id='tag' v-model='key'>
            <option>-</option>
            <option v-for='word in tag_options' v-bind:value='word.id'>{{ word.tag }}</option>
        </select>
        <ul>
            <li v-for='mini in minis.results'>
                <p>{{ mini.name }}</p>
                <img :src='mini.image_url[0]'>
                <div v-if='mini.displayDetail != true'>
                    <button @click='mini.displayDetail = true'>show</button>
                </div>
                <div v-if='mini.displayDetail'>
                    <p>{{ mini.name }}</p>
                        <img class='col-md-1' v-for='img in mini.image_url' :src='img'>
                    <button @click='mini.displayDetail = false'>hide</button>
                    <ul>
                        <li v-for='tag in mini.tag_names'>{{ tag }}</li>
                    </ul>
                </div> 
            </li>
        </ul>
        <template v-if='minis.results'>           
            <button v-if='page != 1' @click='firstPage()' type='button'>First Page</button>
            <button v-if="page > 1" @click='previousPage()' type='button'>Previous Page</button>
            <button v-if='minis.next' @click='nextPage()' type='button'>Next Page</button>
        </template>
    </div>
    
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/vue"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                baseURL: 'http://localhost:8000/apis/v1/?page=',
                minis: [],
                key: '',
                tag_options: '',
                page: 1,
                last_page: false,
                // mini_tags: [],
            },
            methods: {
                filterMinis : function () {
                    axios({
                        url: this.baseURL+this.page,
                        method: 'get',
                        params: {
                            tags : this.key,
                            page: this.page
                        }
                    }).then (response => {
                        const manipulatedData = response.data
                        manipulatedData.results = manipulatedData.results.map(mini => {
                            mini.displayDetail = false
                            return mini
                        })
                        manipulatedData.results = manipulatedData.results.map(mini => {
                            mini.image_url = mini.image_url.slice(2,-2).split("', '")
                            return mini
                        })
                        manipulatedData.results = manipulatedData.results.map(mini => {
                            mini.tag_names = []
                            mini.tags.forEach(mini_tag => {
                                let tag = this.tag_options.find(tag => {
                                    return tag.id === mini_tag
                                })
                                mini.tag_names.push(tag.tag)
                            });
                            return mini
                        })
                        this.minis = manipulatedData
                    })
                },
                tagSelect(event){
                    this.page = 1
                    this.filterMinis()
                },
                firstPage: function () {
                    this.page = 1,
                    this.filterMinis()
                },
                nextPage: function () {
                    this.page += 1,
                    this.filterMinis()
                },
                previousPage: function () {
                    this.page -= 1,
                    this.filterMinis()
                },
                showDetail: function (event) {
                    this.displayDetail = true
                },
                hideDetail: function () {
                    this.displayDetail = false
                },
                showTags: function () {
                    // this.tag_options.filter(this.key) = this.mini_tags
                    // console.log(this.mini_tags)

                    // axios({
                    //     url: 'http://localhost:8000/apis/v1/tag/',
                    //     method: 'get',
                    //     params: {
                    //         id: this.key
                    //     },
                    // }).then (response => {
                    //     this.mini_tags = response.data,
                    //     console.log(this.mini_tags)
                    //     console.log(this.tag_options)
                    //     console.log("hi")
                    //     console.log(this.key)
                    // })
                }
            },
            mounted: function() {
                axios({
                    url: 'http://localhost:8000/apis/v1/tag/',
                    method: 'get',
                }).then (response => {
                    this.tag_options = response.data
                })
            },
        })
    </script>
</body>
</html>


<!-- 
methods: {
    showMinis: function() {
        axios({
            method: 'get',
            url: 'http://localhost:8000/apis/v1',
        }).then(response => {
            this.minis = response.data
        })
    }
}, -->